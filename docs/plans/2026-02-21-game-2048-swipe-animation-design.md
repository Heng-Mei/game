# 2048 滑动动画设计

日期：2026-02-21

## 目标
- 为现有 Canvas 版 2048 增加更接近经典网页的过渡动画。
- 包含三类视觉反馈：
  1) 方块滑动动画
  2) 合并后目标格放大回弹
  3) 新生成方块弹入

## 范围
- 仅改 `game2048.js` 渲染和输入节流逻辑。
- 不改变游戏规则：有效移动后才生成新方块，2/4 概率 90%/10%，同回合单次合并。

## 动画时序（用户已确认）
- 滑动阶段：90ms
- 回弹阶段：70ms

## 方案
- 每次有效移动时，不直接“静态刷新”到目标棋盘，而是先计算轨迹并记录动画状态：
  - `movingTiles`: 每个源方块的起点和终点
  - `finalGrid`: 移动与合并后的目标棋盘
  - `mergePops`: 合并目标坐标
  - `spawnPop`: 新方块坐标
- `update(delta)` 驱动阶段切换：
  - `slide` 阶段使用位置插值
  - `pop` 阶段在 `finalGrid` 上执行 scale 动画
- 动画运行时锁输入，防止连续输入导致状态错乱。

## 兼容性
- 桌面键盘和移动端滑动输入都沿用现有接口。
- 手机端只改变渲染效果，不改变滑动识别阈值与规则。

## 验证
- 在 `tests/game2048_smoke.sh` 增加动画关键字检查。
- 跑现有 smoke 与 JS 语法检查确认无回归。

